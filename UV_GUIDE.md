# Using uv with JIRA to Markdown Converter

This project uses [uv](https://github.com/astral-sh/uv) for fast, reliable Python package management.

## Why uv?

- **10-100x faster** than pip for installing packages
- **Reliable** dependency resolution
- **Compatible** with pip and existing workflows
- **Modern** Python tooling written in Rust

## Quick Start

### 1. Install uv

```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"

# Or with pip
pip install uv
```

### 2. Set up the project

**Recommended: Using `uv sync` (with lock file)**

```bash
# Sync all dependencies from uv.lock
uv sync

# Or sync with development dependencies
uv sync --extra dev

# Activate the virtual environment
source .venv/bin/activate  # macOS/Linux
# or
.venv\Scripts\activate     # Windows
```

**Alternative: Using `uv pip` (manual)**

```bash
# Create a virtual environment
uv venv

# Activate it
source .venv/bin/activate  # macOS/Linux
# or
.venv\Scripts\activate     # Windows

# Install the project
uv pip install -e .
```

### 3. Start using it

```bash
# Test the installation
jira-to-md --help

# Set up your credentials
cp .env.example .env
# Edit .env with your JIRA credentials

# Test connection
jira-to-md test-connection
```

## Common uv Commands

### Using `uv sync` (Recommended)

`uv sync` is the modern, recommended way to manage dependencies with a lock file for reproducible builds.

```bash
# Sync dependencies from lock file (creates/updates .venv)
uv sync

# Sync with development dependencies
uv sync --extra dev

# Sync all extras
uv sync --all-extras

# Update lock file (run when pyproject.toml changes)
uv lock

# Update specific package and lock file
uv lock --upgrade-package jira

# Update all packages and lock file
uv lock --upgrade
```

**Benefits of `uv sync`:**
- ✅ **Reproducible**: Everyone gets exact same dependency versions
- ✅ **Fast**: Uses lock file for instant installation
- ✅ **Automatic**: Creates virtual environment if missing
- ✅ **Safe**: Verifies checksums from lock file

### Using `uv pip` (Alternative)

```bash
# Install project dependencies
uv pip install -e .

# Install with development tools (pytest, black, ruff, mypy)
uv pip install -e ".[dev]"

# Install a single package
uv pip install requests

# Install from requirements.txt (legacy)
uv pip install -r requirements.txt
```

### Manage virtual environments

```bash
# Create a new virtual environment
uv venv

# Create with a specific Python version
uv venv --python 3.11

# Remove virtual environment
rm -rf .venv
```

### Update dependencies

```bash
# Upgrade a specific package
uv pip install --upgrade jira

# Upgrade all packages
uv pip install --upgrade -e ".[dev]"

# Show outdated packages
uv pip list --outdated
```

### Development workflow

**Using `uv sync` (Recommended)**

```bash
# Initial setup with dev dependencies
uv sync --extra dev

# Activate virtual environment
source .venv/bin/activate

# Run tests
pytest tests/

# Format code
black jira_to_markdown/ tests/

# Lint code
ruff check jira_to_markdown/

# Type check
mypy jira_to_markdown/

# Run all quality checks
black jira_to_markdown/ tests/ && \
ruff check jira_to_markdown/ && \
mypy jira_to_markdown/ && \
pytest tests/

# After modifying dependencies in pyproject.toml
uv lock              # Update lock file
uv sync --extra dev  # Sync environment
```

**Using `uv pip` (Alternative)**

```bash
# Install development dependencies
uv pip install -e ".[dev]"

# Run tests, format, lint, etc. (same as above)
pytest tests/
black jira_to_markdown/ tests/
ruff check jira_to_markdown/
mypy jira_to_markdown/
```

## Migrating from pip

All standard `pip` commands work with `uv pip`:

```bash
# Instead of:          # Use:
pip install package    uv pip install package
pip freeze             uv pip freeze
pip list               uv pip list
pip uninstall package  uv pip uninstall package
```

## Understanding the Lock File (`uv.lock`)

The `uv.lock` file ensures **reproducible installations** across all environments.

### What is a lock file?

- **Purpose**: Records exact versions of all dependencies (including transitive deps)
- **Benefits**: Everyone on the team gets identical dependencies
- **Generated by**: `uv lock` or automatically by `uv sync`
- **Should be committed**: Yes! Commit `uv.lock` to version control

### Lock file workflow

```bash
# 1. Modify dependencies in pyproject.toml
vim pyproject.toml

# 2. Update the lock file
uv lock

# 3. Sync your environment
uv sync --extra dev

# 4. Commit both files
git add pyproject.toml uv.lock
git commit -m "Update dependencies"
```

### When teammates pull changes

```bash
# Pull latest code
git pull

# Sync to match the lock file
uv sync --extra dev

# Done! You now have identical dependencies
```

### Lock file vs requirements.txt

| Feature | uv.lock | requirements.txt |
|---------|---------|------------------|
| Exact versions | ✅ Yes | ⚠️ If pinned manually |
| Transitive deps | ✅ Automatic | ❌ Manual |
| Reproducibility | ✅ Guaranteed | ⚠️ Best effort |
| Update workflow | `uv lock` | Manual editing |
| Modern standard | ✅ Yes | ❌ Legacy |

## Configuration

The project is configured via `pyproject.toml`:

- **Dependencies**: Listed in `[project.dependencies]`
- **Dev dependencies**: Listed in `[project.optional-dependencies.dev]`
- **Scripts**: CLI entry points in `[project.scripts]`
- **Build system**: Uses `hatchling` for building
- **Lock file**: Generated automatically by uv, commit to git

## Troubleshooting

### uv not found after installation

```bash
# Add to PATH (macOS/Linux)
export PATH="$HOME/.local/bin:$PATH"

# Add to PATH (Windows)
# Add %USERPROFILE%\.local\bin to your PATH environment variable
```

### Virtual environment issues

```bash
# Remove and recreate
rm -rf .venv
uv venv
source .venv/bin/activate
uv pip install -e ".[dev]"
```

### Package conflicts

```bash
# Clear cache and reinstall
rm -rf ~/.cache/uv
uv pip install --force-reinstall -e .
```

## Performance Comparison

Example installation times (approximate):

| Tool | Cold Install | Warm Install |
|------|--------------|--------------|
| pip  | ~30s         | ~15s         |
| uv   | ~3s          | ~1s          |

## Resources

- [uv Documentation](https://github.com/astral-sh/uv)
- [Python Packaging Guide](https://packaging.python.org/)
- [pyproject.toml Specification](https://peps.python.org/pep-0621/)
